# ğŸš€ ××“×¨×™×š ×”×¨×¦×ª ××™×’×¨×¦×™×•×ª â€“ ×›×¤×¨ ×—×‘"×“ GIS

## ğŸ“– ××” ×–×” ×‘×›×œ×œ ××™×’×¨×¦×™×”?

×“××™×™×Ÿ ×©×™×© ×œ×š ×§×•×¤×¡×ª ×œ×’×• ×¢× ×§×™×ª (×”×“××˜×”×‘×™×™×¡ ×©×œ×š).
**××™×’×¨×¦×™×”** = ×”×•×¨××•×ª ××™×š ×œ×”×•×¡×™×£ ×—×œ×§×™× ×—×“×©×™× ×œ×§×•×¤×¡×”.

×‘××§×•× ×œ×”×•×¡×™×£ ×™×“× ×™×ª ×›×œ ×—×œ×§, ××ª×” × ×•×ª×Ÿ ×œ××—×©×‘ ×“×£ ×”×•×¨××•×ª ×•×”×•× ×¢×•×©×” ×”×›×œ ×‘×©×‘×™×œ×š!

---

## ğŸ—ï¸ ××¨×›×™×˜×§×˜×•×¨×ª ×”× ×ª×•× ×™×

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ××—×©×‘ ××§×•××™          â”‚     â”‚   ×¢× ×Ÿ (Supabase)      â”‚
â”‚                      â”‚     â”‚                     â”‚
â”‚  SQLite DB           â”‚     â”‚  PostgreSQL DB      â”‚
â”‚  + ×§×‘×¦×™× ×¢×œ ×”×“×™×¡×§    â”‚â†â”€â”€â†’â”‚  (××™×“×¢ ×‘×œ×‘×“)        â”‚
â”‚                      â”‚     â”‚                     â”‚
â”‚  ğŸ“‹ ×‘×¨×™×¨×ª ××—×“×œ       â”‚     â”‚  â˜ï¸ ×’×™×‘×•×™/fallback  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**×›×œ×œ ×‘×¨×–×œ:** ×”××¢×¨×›×ª ××—×¤×©×ª ×§×•×“× ×‘××—×©×‘. ×× ×œ× ××•×¦××ª â€“ ×¢×•×‘×¨×ª ×œ×¢× ×Ÿ.

---

## ğŸ”‘ ×¤×¨×˜×™ ×”×—×™×‘×•×¨ ×œ×¢× ×Ÿ

| ×¤×¨××˜×¨ | ×¢×¨×š |
|-------|-----|
| **Supabase URL** | `https://txltujmbkhsszpvsgujs.supabase.co` |
| **Project ID** | `txltujmbkhsszpvsgujs` |
| **Dashboard** | https://supabase.com/dashboard/project/txltujmbkhsszpvsgujs |

---

## ğŸ› ï¸ ×©× ×™ ×›×œ×™× ×œ×”×¨×¦×ª ××™×’×¨×¦×™×•×ª

### ×›×œ×™ 1: ×“×¨×š ×”××ª×¨ (SettingsDialog)

1. ×¤×ª×— ××ª ×”××ª×¨
2. ×œ×š ×œ**×”×’×“×¨×•×ª** (×‘×¡×™×™×“×‘×¨)
3. ××¦× ××ª **×›×œ×™ ×¤×™×ª×•×—** â†’ ×›×¤×ª×•×¨ âš™ï¸ ×”×’×“×¨×•×ª
4. ×‘×œ×©×•× ×™×ª **×¤×™×ª×•×—** â†’ ×”×›× ×¡ SQL ××• ×”×¢×œ×” ×§×•×‘×¥ `.sql`
5. ×œ×—×¥ **×”×¨×¥ ××™×’×¨×¦×™×”**

### ×›×œ×™ 2: ×¡×§×¨×™×¤×˜ Python (upload_to_supabase.py)

××¡× ×›×¨×Ÿ ××ª ×›×œ ×”× ×ª×•× ×™× ×-SQLite ×”××§×•××™ ×œ×¢× ×Ÿ:

```powershell
cd "c:\Users\jj121\OneDrive\×©×•×œ×—×Ÿ ×”×¢×‘×•×“×”\meida"
python upload_to_supabase.py
```

---

## ğŸ“‹ ×˜×‘×œ××•×ª ×‘×¢× ×Ÿ

| ×˜×‘×œ×” | ×ª×™××•×¨ | ×©×•×¨×•×ª |
|------|-------|-------|
| `gushim` | ×’×•×©×™× ×§×“×¡×˜×¨×™×™× | 12 |
| `parcels` | ×—×œ×§×•×ª (×’×•×©+×—×œ×§×”) | 40 |
| `plans` | ×ª×•×›× ×™×•×ª ×™×™×—×•×“×™×•×ª | 19 |
| `documents` | ××¡××›×™× ×©×”×•×¨×“×• | 120 |
| `plan_georef` | × ×ª×•× ×™ ×’×™××•×¨×¤×¨× ×¡ | 3 |

> âš ï¸ **aerial_images** â€“ ×œ× ×‘×¢× ×Ÿ ×¢×“×™×™×Ÿ (×§×‘×¦×™× ×›×‘×“×™×, ×¨×§ ××§×•××™×ª)

---

## ğŸ® ××™×š ×œ×”×©×ª××© â€“ ×¦×¢×“ ××—×¨ ×¦×¢×“

### ×©×œ×‘ 1: ×¤×ª×— ××ª ×”×˜×¨××™× ×œ ×‘-VS Code
×œ×—×¥ ×¢×œ: **Ctrl + `** (×”×›×¤×ª×•×¨ ××ª×—×ª ×œ-Esc)

### ×©×œ×‘ 2: ×¢×‘×•×¨ ×œ×ª×™×§×™×™×ª ×”×¤×¨×•×™×§×˜
```powershell
cd "c:\Users\jj121\OneDrive\×©×•×œ×—×Ÿ ×”×¢×‘×•×“×”\meida"
```

---

## ğŸ“‹ ×¤×§×•×“×•×ª ×©×™××•×©×™×•×ª

### 1ï¸âƒ£ ×™×¦×™×¨×ª ×˜×‘×œ××•×ª ×‘×¢× ×Ÿ (×¤×¢× ×¨××©×•× ×”)

×”×¨×¦×ª ×§×•×‘×¥ ×”-SQL ×“×¨×š edge function:

```powershell
python -c "
import httpx, json
SUPABASE_URL = 'https://txltujmbkhsszpvsgujs.supabase.co'
ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InR4bHR1am1ia2hzc3pwdnNndWpzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzEzMzgyMzIsImV4cCI6MjA4NjkxNDIzMn0.K3y9ZkrmmnZifjHgwzkoekvCB3dgyINFh6bPRki4YUw'
with open('supabase/migrations/001_create_tables.sql', 'r', encoding='utf-8') as f:
    sql = f.read()
resp = httpx.post(f'{SUPABASE_URL}/functions/v1/run-sql',
    headers={'Authorization': f'Bearer {ANON_KEY}', 'Content-Type': 'application/json'},
    json={'sql': sql}, timeout=30)
print(json.dumps(resp.json(), indent=2, ensure_ascii=False)[:1000])
"
```

### 2ï¸âƒ£ ×”×¢×œ××ª ×›×œ ×”× ×ª×•× ×™× ×œ×¢× ×Ÿ

```powershell
python upload_to_supabase.py
```

**××” ×™×§×¨×”:**
```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ğŸš€ Upload Local DB â†’ Supabase Cloud
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“¦ DB: kfar_chabad_documents.db
â˜ï¸  Target: https://txltujmbkhsszpvsgujs.supabase.co

ğŸ“¤ Uploading gushim...
  âœ… gushim: 12/12 rows uploaded
ğŸ“¤ Uploading parcels...
  âœ… parcels: 40/40 rows uploaded
...
âœ… All data uploaded successfully!

ğŸ“Š Verification:
  âœ… gushim: local=12, cloud=12
  âœ… parcels: local=40, cloud=40
  âœ… plans: local=19, cloud=19
  âœ… documents: local=120, cloud=120
  âœ… plan_georef: local=3, cloud=3
```

### 3ï¸âƒ£ ×”×¨×¦×ª SQL ×™×©×™×¨×•×ª ×¢×œ ×”×¢× ×Ÿ

```powershell
python -c "
import httpx
SUPABASE_URL = 'https://txltujmbkhsszpvsgujs.supabase.co'
ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InR4bHR1am1ia2hzc3pwdnNndWpzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzEzMzgyMzIsImV4cCI6MjA4NjkxNDIzMn0.K3y9ZkrmmnZifjHgwzkoekvCB3dgyINFh6bPRki4YUw'
resp = httpx.post(f'{SUPABASE_URL}/functions/v1/run-sql',
    headers={'Authorization': f'Bearer {ANON_KEY}', 'Content-Type': 'application/json'},
    json={'sql': 'SELECT COUNT(*) as total FROM gushim'}, timeout=15)
print(resp.json())
"
```

### 4ï¸âƒ£ ×‘×“×™×§×ª × ×ª×•× ×™× ×“×¨×š REST API

```powershell
# ×¡×¤×™×¨×ª ×’×•×©×™×
curl "https://txltujmbkhsszpvsgujs.supabase.co/rest/v1/gushim?select=count" -H "apikey: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InR4bHR1am1ia2hzc3pwdnNndWpzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzEzMzgyMzIsImV4cCI6MjA4NjkxNDIzMn0.K3y9ZkrmmnZifjHgwzkoekvCB3dgyINFh6bPRki4YUw" -H "Prefer: count=exact" -I

# ×¨×©×™××ª ×’×•×©×™×
curl "https://txltujmbkhsszpvsgujs.supabase.co/rest/v1/gushim?order=gush.asc" -H "apikey: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InR4bHR1am1ia2hzc3pwdnNndWpzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzEzMzgyMzIsImV4cCI6MjA4NjkxNDIzMn0.K3y9ZkrmmnZifjHgwzkoekvCB3dgyINFh6bPRki4YUw"
```

---

## ğŸ”„ ××™×š ×”×¤×•×œ×‘×§ ×¢×•×‘×“

```
×©××™×œ×ª×” × ×›× ×¡×ª (×œ×“×•×’××”: /api/gushim)
         â”‚
         â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ ×™×© SQLite    â”‚â”€â”€â”€×›×Ÿâ”€â”€â†’ ğŸ“‹ ××—×–×™×¨ ×-SQLite
  â”‚ ××§×•××™?       â”‚          (source: "local")
  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ ×œ×
         â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ ×©×•××œ ××ª      â”‚â”€â”€â”€×›×Ÿâ”€â”€â†’ â˜ï¸ ××—×–×™×¨ ×-Supabase
  â”‚ Supabase     â”‚          (source: "cloud")
  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ × ×›×©×œ
         â–¼
      âŒ ×©×’×™××”
```

×›×œ ×ª×©×•×‘×ª API ××›×™×œ×” ×©×“×” `"source"` â€“ `"local"` ××• `"cloud"`.

---

## ğŸ“ ×§×‘×¦×™ ××™×’×¨×¦×™×”

```
meida/
â”œâ”€â”€ supabase/
â”‚   â”œâ”€â”€ config.toml                    # ×”×’×“×¨×•×ª Supabase
â”‚   â”œâ”€â”€ functions/
â”‚   â”‚   â””â”€â”€ run-sql/index.ts           # Edge function ×œ×”×¨×¦×ª SQL
â”‚   â””â”€â”€ migrations/
â”‚       â”œâ”€â”€ 001_create_tables.sql      # ×™×¦×™×¨×ª ×˜×‘×œ××•×ª (gushim, parcels, plans, documents, plan_georef)
â”‚       â”œâ”€â”€ 20260217...7a4bafe5.sql    # GIS layers + storage bucket
â”‚       â””â”€â”€ 20260217...e18cc43f.sql    # Profiles + user roles
â”œâ”€â”€ upload_to_supabase.py             # ×¡×§×¨×™×¤×˜ ×¡× ×›×¨×•×Ÿ ××§×•××™â†’×¢× ×Ÿ
â””â”€â”€ kfar_chabad_documents.db          # SQLite ××§×•××™
```

---

## âš ï¸ ××” ×œ×¢×©×•×ª ×›×©×™×© ×©×’×™××”?

### ×©×’×™××”: "relation does not exist"
**×”×‘×¢×™×”:** ×”×˜×‘×œ×” ×œ× × ×•×¦×¨×” ×¢×“×™×™×Ÿ
**×”×¤×ª×¨×•×Ÿ:** ×”×¨×¥ `001_create_tables.sql` ×§×•×“×

### ×©×’×™××”: "duplicate key value"
**×”×‘×¢×™×”:** ×”× ×ª×•× ×™× ×›×‘×¨ ×§×™×™××™× ×‘×¢× ×Ÿ
**×”×¤×ª×¨×•×Ÿ:** ×”×¡×§×¨×™×¤×˜ ××•×—×§ ×•××¢×œ×” ××—×“×© â€“ ×¤×©×•×˜ ×”×¨×¥ ×©×•×‘

### ×©×’×™××”: "permission denied"
**×”×‘×¢×™×”:** ×”-RLS ×œ× ××•×’×“×¨
**×”×¤×ª×¨×•×Ÿ:** ×”×¨×¥ ××ª ×”-migration ×©×›×•×œ×œ ××ª ×”-policies

---

## ğŸ’¡ ×˜×™×¤×™×

1. **×”×¢×œ×” ×œ×¢× ×Ÿ ××—×¨×™ ×›×œ ×©×™× ×•×™ ×’×“×•×œ ×‘-DB** â€“ `python upload_to_supabase.py`
2. **×‘×“×•×§ source ×‘×ª×©×•×‘×ª API** â€“ ×›×›×” ×ª×“×¢ ×× ×”× ×ª×•× ×™× ××’×™×¢×™× ×××§×•××™ ××• ×¢× ×Ÿ
3. **×¦×™×œ×•××™ ××•×•×™×¨ ×¨×§ ××§×•××™×ª** â€“ ×œ× ××•×¢×œ×™× ×œ×¢× ×Ÿ (×§×‘×¦×™× ×›×‘×“×™× ××“×™)
4. **Dashboard ××œ×** â€“ https://supabase.com/dashboard/project/txltujmbkhsszpvsgujs

---

## ğŸ“ ×¡×™×›×•×

| ××” ×¨×•×¦×™× | ×”×¤×§×•×“×” |
|----------|--------|
| ×œ×™×¦×•×¨ ×˜×‘×œ××•×ª ×‘×¢× ×Ÿ | ×”×¨×¥ `001_create_tables.sql` ×“×¨×š SettingsDialog ××• edge function |
| ×œ×¡× ×›×¨×Ÿ × ×ª×•× ×™× ×œ×¢× ×Ÿ | `python upload_to_supabase.py` |
| ×œ×©××•×œ ××ª ×”×¢× ×Ÿ ×™×©×™×¨×•×ª | `curl` ×¢× Supabase REST API |
| ×œ×‘×“×•×§ ×××™×¤×” × ×ª×•× ×™× | ×—×¤×© `"source": "local"` ××• `"cloud"` |

---

**ğŸŒŸ ×”×›×œ ××¡×•× ×›×¨×Ÿ! ××§×•××™ â† ×¢× ×Ÿ, ×¢× fallback ××•×˜×•××˜×™.**
